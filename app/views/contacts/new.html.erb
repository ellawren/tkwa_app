<% provide :title, "New Contact" %>
<div class="page-header">
	<h1>Add a New Contact</h1>
</div>

<!-- modal for search company -->
<div class="modal hide fade company-modal" id="searchCompany" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">Search Company Name</h3>
    </div>
    <div class="modal-body">
		<%= search_form_for @q, url: search_companies_path, :html => { method: :post } do |s| %>
			<div class="input-row">
				<%= s.label(:name_cont, "Company Name", class: "input-label") %>
				<%= s.text_field :name_cont, class: "search-name contact", placeholder: "" %> 
			</div>
		<% end %>

		<% if @companies.count > 0 %>
			<div id="companies"></div>
		<% end %>

		<script>
		$("#company_search input").keyup(function() {
		    $.get($("#company_search").attr("action"), $("#company_search").serialize(), null, "script");
		    return false;
		  });
		</script>
    </div>
</div>
<!-- end modal -->

<!-- modal for add company -->
<%= form_for @company do |f| %>
	<div class="modal hide fade add-company-modal" id="addCompany" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	    <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	        <h3 id="myModalLabel">Add Company</h3>
	    </div>
	    <div class="modal-body">
	    	<div class="wide">
	            <div class="input-row">
	                <%= f.label(:name, "Company", class: "input-label") %>
	                <%= f.text_field :name %>
	            </div>
	            
	            <div class="input-row">
	                <%= f.label(:address, "Work Address", class: "input-label") %>
	                <%= f.text_area :address, class: "", rows: "2" %>
	            </div>   
	            <div class="input-row">
	                <%= f.label(:url, "Website", class: "input-label") %>
	                <%= f.text_field :url, class: "" %>
	            </div>   
	        </div>

	        <div class="narrow contact-phone">
	            <div class="input-row">
	                <%= f.label :phone, "Main Phone", class: "input-label" %>
	                <%= f.text_field :phone, value: number_to_phone(@company.phone, :area_code => true), class: "phone input-adjust" %>
	            </div>
	            <div class="input-row">
	                <%= f.label(:fax, "Fax Number", class: "input-label") %>
	                <%= f.text_field :fax, value: number_to_phone(@company.fax, :area_code => true), class: "phone input-adjust" %>
	            </div>
	        </div>
			
			<div class="save-row">
	            <%= f.submit "Add Company", class: "btn btn-primary save-btn" %>
	        </div>
	        <script>
			
		    $('#new_company').submit(function() {  
		        var valuesToSubmit = $(this).serialize();
		        $.ajax({
		            type: 'POST',
		            url: $(this).attr('action'), 
		            data: valuesToSubmit,
		            dataType: "JSON"
		        }).success(function(data){
		        	$('#contact_company_id').val(data.id);
		        	string = "<div class=\"c-name\">" + data.name + "</div><div class=\"c-address\">" + data.address  + "<div class=\"c-url\"><a href=\"" + data.url + "\" target = \"_blank\">" + data.url + "</a></div>";
		        	phone = "<div class=\"input-row\"><label class=\"input-label\">Main Phone</label><div class=\"text-field\">" + data.phone + "</div></div><div class=\"input-row\"><label class=\"input-label\">Fax</label><div class=\"text-field\">" + data.fax + "</div></div>";
		        	$('#company-data').html(string);
		        	$('#company-phone').html(phone);
		        });
		        $('#addCompany').modal('hide');
		        return false; // prevents normal behaviour
		    });
		
			</script>
	    </div>
	</div>
<% end %>
<!-- end modal -->

<%= form_for @contact do |f| %>
<%= render 'shared/error_messages', object: f.object %>

   <div class="content">
   	
		        <h2>Name</h2>
		        <div class="wide">
		            <div class="input-row">
		                <%= f.label(:name, "Full Name", class: "input-label") %>
		                <%= f.text_field :name %>
		            </div>
		            <div class="input-row">
		                <%= f.label(:work_title, "Title", class: "input-label") %>
		                <%= f.text_field :work_title %>
		            </div>
		        </div>
		        <div class="narrow contact">
		            <div class="input-row">
		                <%= f.label(:post_nominals, "Suffix", class: "input-label" ) %>
		                <%= f.text_field :post_nominals, placeholder: "ex: AIA, LEED AP, etc." %>
		            </div>
		            
		            <div class="input-row">
		                <%= f.label(:cat01, "Category", class: "input-label" ) %>
		                <%= f.collection_select(:cat01, Category.all, :id, :name, { :include_blank => true }, { :class => "custom-select" } ) %>
		            </div>
		            <!--    <%= is_set?(@contact.cat02, "cat02", f.label(" ", " ", class: "input-label" ), f.collection_select(:cat02, Category.all, :id, :name, { :include_blank => true }, { :class => "custom-select" } ) ) %>
		                
		                <%= is_set?(@contact.cat03, "cat03", f.label(" ", " ", class: "input-label" ), f.collection_select(:cat03, Category.all, :id, :name, { :include_blank => true }, { :class => "custom-select" } ) ) %>

		                <%= is_set?(@contact.cat04, "cat04", f.label(" ", " ", class: "input-label" ), f.collection_select(:cat04, Category.all, :id, :name, { :include_blank => true }, { :class => "custom-select" } ) ) %>

		                <%= is_set?(@contact.cat05, "cat05", f.label(" ", " ", class: "input-label" ), f.collection_select(:cat05, Category.all, :id, :name, { :include_blank => true }, { :class => "custom-select" } ) ) %>
		            
		                <%= is_set?(@contact.cat06, "cat06", f.label(" ", " ", class: "input-label" ), f.collection_select(:cat06, Category.all, :id, :name, { :include_blank => true }, { :class => "custom-select" } ) ) %>
		                <% if @contact.cat06.blank? %>
		                    <%= link_to_add_category("", f, "cat02", "add fui-plus category") %>
		                <% end %>
		            -->
		        </div>

		        <h2>Work Information</h2>
		        <div id="selected-company">
		        	<div class="wide">
		        		<%= f.hidden_field :company_id %>
						<div class="input-row company">
			                <%= f.label(:work_company, "Company", class: "input-label") %>
			                <div id="company-data" class="text-field">
				                <a id="search-company" data-target="#searchCompany" data-toggle="modal" class="btn">Search for Company</a>
				                <a id="add-company" data-target="#addCompany" data-toggle="modal" class="btn">Add New Company</a>
				            </div>
			            </div>
		        	</div>
	                <div id="company-phone" class="narrow contact-phone"></div>
		        </div>

		        <div class="wide">
		        	<div class="input-row">
		                <%= f.label(:work_department, "Department", class: "input-label") %>
		                <%= f.text_field :work_department %>
		            </div>   
		            <div class="input-row">
		                <%= f.label(:work_email, "Work Email", class: "input-label") %>
		                <%= f.text_field :work_email %>
		            </div>  
		        </div>

		        <div class="narrow contact-phone">
		        	<div class="input-row">
		                <%= f.label(:work_direct, "Direct Phone", class: "input-label") %>
		                <%= f.text_field :work_direct, value: number_to_phone(@contact.work_direct, :area_code => true), class: "phone" %>
		                <div class="label-sm">ext</div><%= f.text_field :direct_ext, class: "ext" %>
		            </div>
		            <div class="input-row">
		                <%= f.label(:work_cell, "Work Cell", class: "input-label") %>
		                <%= f.text_field :work_cell,value: number_to_phone(@contact.work_cell, :area_code => true), class: "phone" %>
		            </div>
		        </div>

		        <h2>Personal Information</h2>

		        <div class="wide">
		            <div class="input-row">
		                <%= f.label(:home_address, "Home Address", class: "input-label") %>
		                <%= f.text_area :home_address, class: "", rows: "2" %>
		            </div>    
		            <div class="input-row">
		                <%= f.label(:home_email, "Personal Email", class: "input-label") %>
		                <%= f.text_field :home_email %>
		            </div>  
		        </div>

		        <div class="narrow contact-phone">
		            <div class="input-row">
		                <%= f.label :home_phone, "Home Phone", class: "input-label" %>
		                <%= f.text_field :home_phone, value: number_to_phone(@contact.home_phone, :area_code => true), class: "phone" %>
		            </div>
		            <div class="input-row">
		                <%= f.label(:home_cell, "Personal Cell", class: "input-label") %>
		                <%= f.text_field :home_cell,value: number_to_phone(@contact.home_cell, :area_code => true), class: "phone" %>
		            </div>
		        </div>

        <div class="save-row">
            <%= f.submit "Add Contact", class: "btn btn-primary save-btn" %>
        </div>

    </div> <!-- end content -->

<% end %>

