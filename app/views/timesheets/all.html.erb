<% content_for :page_header do %>
  <% provide :title, "Timesheets" %>
  <div class="page-header">
    <h1><%= @user.name %>'s Timesheets</h1>
  </div>
<% end %>

<h4><%= this_year %></h4><br />
<table class="table right-align timesheets">
	<thead>
		<tr>
			<th class="left">Week</th>
			<th class="left">Dates</th>
			<th>Pay Type</th>
			<th>Total Hours</th>
			<th>Goal</th>
			<th>Over/Under</th>
			<th>Status</th>			
			<th></th>
		</tr>
	</thead>
	<tbody>
		<% (1..this_week).each do |w| %>
			<% t = Timesheet.find_or_create_by_user_id_and_week_and_year(@user.id, w, this_year) %>
			<tr>
				<td class="left"><%= t.week %></td>
				<td class="left"><%= parse_date(t.week, t.year) %></td>
				<td><%= t.data_record.pay_type %></td>
				<td class="bold"><%= precise(nonzero?(t.timesheet_total)) %></td>
				<td><%= (t.ytd_goal(t.week - t.data_record.start_week + 1).to_f) %></td>
				<td>
					<% if (t.year == this_year && t.week < this_week) || t.year < this_year %>
						<%= number_with_precision(t.ytd('total').to_f - (t.ytd_goal(t.week - t.data_record.start_week + 1).to_f), strip_insignificant_zeros: true) %>
					<% end %>
				</td>
				<td><%= t.complete == true ? "open" : "closed" -%></td>
  				<td><%= link_to "go to timesheet", user_timesheet_path(t.user_id, t.year, t.week), class: "btn" %></td>
			</tr>
		<% end %>
	</tbody>
</table>		
