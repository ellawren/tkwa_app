<% content_for :page_header do %>
	<% provide :title, "Employees Index" %>
	<div class="page-header">
		<h1>Employee Data</h1>
	</div>
<% end %>

<!-- modal for employee target edit -->
	<div class="modal hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  	<div class="modal-header">
	    	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	    	<h3 id="myModalLabel"> </h3>
	  	</div>
	  	<div class="modal-body"></div>
	</div>
<!-- end modal -->

<!-- modal for employee target edit -->
	<div class="modal hide fade" id="newModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  	<div class="modal-header">
	    	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	    	<h3 id="myModalLabel"> </h3>
	  	</div>
	  	<div class="modal-body"></div>
	</div>
<!-- end modal -->

<a href=<%= "/data_records/new" %> data-target="#newModal" data-toggle="modal" class="btn btn-primary btn-right">Add New Record</a>

	<% year_array(@data_records).each do |y| %>
		<h4><%= y %></h4><br />
		<table class="table right-align data-records">
			<thead>
				<tr>
					<th class="left-align">Name</th>
									<th>Year</th>
					<th>Weeks</th>
					<th>Pay Type</th>
					<th>Hrs/Wk</th>
					<th>Billable/Wk</th>
					<th>Holiday/Day</th>
					<th>Vacation<br>This Period</th>
					<th>Vacation<br>Rollover</th>
					<th>Hourly Rate</th>
					<th>Billable Rate</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<% data = DataRecord.find_all_by_year(y).sort {|a,b| a.user_name <=> b.user_name} %>
				<% data.each do |d| %>
					<tr>
						<td>
							<div class="user-name">
								<a href=<%= "/users/#{d.user_id}/data_records/#{d.id}" %> data-target="#myModal" data-toggle="modal" class="modal-btn edit-targets"><%= d.user_name %></a>
							</div>
							<div class="employee-number">
								<%= User.find(d.user_id).employee_number %>
							</div>
						</td>
						<td><%= d.year %></td>
						<td><%= "#{d.start_week} - #{d.end_week}" %></td>
						<td><%= d.pay_type %></td>
		  				<td><%= d.hours_in_week %></td>
		  				<td><%= d.billable %></td>
		  				<td><%= d.holiday %></td>
		  				<td><%= d.vacation %></td>
		  				<td><%= d.vacation_rollover %></td>
		  				<td><%= number_to_currency(d.rate) %></td>
		  				<td><%= number_to_currency(d.billable_rate) %></td>
		  				<td>
		  					<% if current_user.admin? %>
		  						<%= link_to "delete", d, method: :delete, confirm: "You sure?" %>
								<% end %>
						</td>
					</tr>
				<% end %>
			</tbody>
		</table>		
	<% end %>

<script>
//reset modal remote on close
    $('#myModal').on('hidden', function () {
        $(this).removeData('modal');
    })
    $('#newModal').on('hidden', function () {
        $(this).removeData('modal');
    })
</script>
